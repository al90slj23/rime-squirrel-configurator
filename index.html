<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Rime 管须鼠可视化配置器 v1.2（.custom.yaml 生成器）</title>
<link rel="icon" type="image/svg+xml" href="favicon.svg" />
<script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
<link rel="stylesheet" href="style.css">
</head>
<body>
<!-- 主题切换按钮 -->
<button class="theme-toggle" id="themeToggle" aria-label="切换主题">
  <span id="themeIcon">🌙</span>
</button>

<div class="wrap">
  <h1>Rime 可视化配置器 <span class="badge">生成 *.custom.yaml</span><span class="badge" style="margin-left:8px">v1.2</span></h1>

  <div class="card">
    <div class="grid">
      <div class="section">
        <h2>方案（Schema）</h2>
        <div style="margin-bottom:8px">
          <div class="label-text" style="margin-bottom:8px">方案标识（文件前缀）</div>
          <input id="schemaId" type="text" value="luna_pinyin" placeholder="例如: luna_pinyin" style="width:100%;max-width:100%" />
        </div>
        <div class="muted">生成的文件名：<code id="outName">luna_pinyin.custom.yaml</code></div>
      </div>

      <div class="section">
        <h2>默认字形</h2>
        <div class="radio-wrap">
          <label><input type="radio" name="simp" value="simp" checked /> 默认简体</label>
          <label><input type="radio" name="simp" value="trad" /> 默认繁体</label>
        </div>
        <div class="muted" style="margin-top:12px">热键切换：<code>Control+Shift+F</code></div>
      </div>

      <div class="section">
        <h2>输入模式</h2>
        <label>
          <input class="switch" id="asciiMode" type="checkbox" checked />
          <span class="label-text">默认「中文模式」</span>
          <span class="badge">关闭=西文</span>
        </label>
        <label>
          <input class="switch" id="fullShape" type="checkbox" />
          <span class="label-text">默认「全角」</span>
          <span class="badge">建议关闭</span>
        </label>
        <label>
          <input class="switch" id="asciiPunct" type="checkbox" checked />
          <span class="label-text">默认「中文标点」</span>
        </label>
      </div>

      <div class="section">
        <h2>快捷键配置</h2>

        <div style="margin-bottom:24px">
          <div style="margin-bottom:12px">
            <span style="font-weight:600;font-size:14px">快捷键风格</span>
          </div>
          <div class="radio-wrap" style="display:flex;gap:20px;width:100%">
            <label style="margin:0"><input type="radio" name="hotkeyStyle" value="windows" checked /> Windows</label>
            <label style="margin:0"><input type="radio" name="hotkeyStyle" value="macos" /> macOS</label>
            <label style="margin:0"><input type="radio" name="hotkeyStyle" value="custom" /> 自定义</label>
          </div>
        </div>

        <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:16px;margin-bottom:16px">
          <!-- Card 1: 切换输入法 -->
          <div style="padding:16px;background:var(--input-bg);border:1px solid var(--border);border-radius:8px">
            <div class="label-text" style="margin-bottom:8px;font-weight:600">切换输入法</div>
            <div style="display:flex;gap:8px;align-items:center">
              <input id="hotkeySwitch" type="text" value="Control+Shift" placeholder="Control+Shift" style="flex:1" />
              <button class="record-btn" data-target="hotkeySwitch" style="padding:10px 16px;white-space:nowrap">录制</button>
            </div>
            <div class="muted" style="margin-top:8px;font-size:13px">轮换切换不同的输入方案</div>
          </div>

          <!-- Card 2: 中英文切换 -->
          <div style="padding:16px;background:var(--input-bg);border:1px solid var(--border);border-radius:8px">
            <div class="label-text" style="margin-bottom:8px;font-weight:600">中英文切换</div>
            <div style="display:flex;gap:8px;align-items:center">
              <input id="hotkeyAscii" type="text" value="Shift_L" placeholder="Shift_L" style="flex:1" />
              <button class="record-btn" data-target="hotkeyAscii" style="padding:10px 16px;white-space:nowrap">录制</button>
            </div>
            <div class="muted" style="margin-top:8px;font-size:13px">在中文和英文模式之间切换</div>
          </div>

          <!-- Card 3: 大小写切换 -->
          <div style="padding:16px;background:var(--input-bg);border:1px solid var(--border);border-radius:8px">
            <div class="label-text" style="margin-bottom:8px;font-weight:600">大小写切换</div>
            <div style="display:flex;gap:8px;align-items:center">
              <input id="hotkeyCapsLock" type="text" value="Caps_Lock" placeholder="Caps_Lock" style="flex:1" />
              <button class="record-btn" data-target="hotkeyCapsLock" style="padding:10px 16px;white-space:nowrap">录制</button>
            </div>
            <div class="muted" style="margin-top:8px;font-size:13px">切换大小写锁定</div>
          </div>

          <!-- Card 4: 全角半角切换 -->
          <div style="padding:16px;background:var(--input-bg);border:1px solid var(--border);border-radius:8px">
            <div class="label-text" style="margin-bottom:8px;font-weight:600">全角半角切换</div>
            <div style="display:flex;gap:8px;align-items:center">
              <input id="hotkeyFullShape" type="text" value="Control+space" placeholder="Control+space" style="flex:1" />
              <button class="record-btn" data-target="hotkeyFullShape" style="padding:10px 16px;white-space:nowrap">录制</button>
            </div>
            <div class="muted" style="margin-top:8px;font-size:13px">在全角和半角字符之间切换</div>
          </div>

          <!-- Card 5: 简繁切换 -->
          <div style="padding:16px;background:var(--input-bg);border:1px solid var(--border);border-radius:8px">
            <div class="label-text" style="margin-bottom:8px;font-weight:600">简繁切换</div>
            <div style="display:flex;gap:8px;align-items:center">
              <input id="hotkey" type="text" value="Control+Shift+F" placeholder="Control+Shift+F" style="flex:1" />
              <button class="record-btn" data-target="hotkey" style="padding:10px 16px;white-space:nowrap">录制</button>
            </div>
            <div class="muted" style="margin-top:8px;font-size:13px">在简体和繁体之间切换</div>
          </div>
        </div>

        <div class="muted" style="margin-top:12px;padding:8px;background:var(--input-bg);border-radius:4px">
          💡 提示：点击"录制"按钮后按下快捷键，或手动输入。多组热键用逗号分隔。
        </div>
      </div>
    </div>
  </div>

  <div class="card">
    <h2 style="margin:0 0 24px">候选词设置</h2>
    <div class="grid">
      <div class="section">
        <h2>页面显示</h2>
        <label>
          <span class="label-text">每页候选词数量</span>
          <input id="pageSize" type="number" min="1" max="10" value="6" style="max-width:100px" />
        </label>
        <div class="muted">建议值：5-9 个</div>
      </div>

      <div class="section">
        <h2>候选词标签</h2>
        <div class="radio-wrap">
          <label><input type="radio" name="selectLabels" value="number" checked /> 数字标签（1 2 3）</label>
          <label><input type="radio" name="selectLabels" value="custom" /> 自定义标签</label>
        </div>
        <label id="customLabelsWrap" style="margin-top:12px;display:none">
          <span class="label-text">自定义标签</span>
          <input id="customLabels" type="text" placeholder="例如: a s d f g h j k l" />
        </label>
        <div class="muted" style="margin-top:8px">数字标签显示为 ①②③... 或 1 2 3...</div>
      </div>
    </div>
  </div>

  <div class="card">
    <h2 style="margin:0 0 24px">高级设置</h2>
    <div class="grid">
      <div class="section">
        <h2>ASCII 模式</h2>
        <label>
          <input class="switch" id="asciiComposer" type="checkbox" checked />
          <span class="label-text">启用 good_old_caps_lock</span>
          <span class="badge">推荐开启</span>
        </label>
        <div class="muted">Caps Lock 传统行为（大写锁定）</div>
      </div>

      <div class="section">
        <h2>识别器模式</h2>
        <label>
          <input class="switch" id="enableEmail" type="checkbox" checked />
          <span class="label-text">邮箱识别</span>
        </label>
        <label>
          <input class="switch" id="enableUrl" type="checkbox" checked />
          <span class="label-text">URL 识别</span>
        </label>
        <label>
          <input class="switch" id="enableUppercase" type="checkbox" checked />
          <span class="label-text">大写字母识别</span>
        </label>
        <div class="muted">自动识别并直接输出特殊格式</div>
      </div>
    </div>

    <div class="grid" style="margin-top:24px">
      <div class="section">
        <h2>标点符号</h2>
        <label>
          <input class="switch" id="enablePunctuator" type="checkbox" checked />
          <span class="label-text">启用标点符号候选</span>
          <span class="badge">推荐开启</span>
        </label>
        <div class="muted">输入 [ / ; 等符号时显示候选框（全角/半角切换）</div>
      </div>

      <div class="section">
        <h2>其他开关</h2>
        <label>
          <input class="switch" id="enableEmoji" type="checkbox" checked />
          <span class="label-text">启用 Emoji 输入</span>
        </label>
        <label>
          <input class="switch" id="enableLunar" type="checkbox" checked />
          <span class="label-text">显示农历日期</span>
        </label>
        <label>
          <input class="switch" id="enableSymbols" type="checkbox" checked />
          <span class="label-text">启用符号输入</span>
          <span class="badge">推荐</span>
        </label>
        <div class="muted">启用后可使用 /blx 输入波浪线（~ ～ ∼ ≈），/ydy 约等于，/zs 箭头等符号</div>
      </div>
    </div>
  </div>

  <div class="card">
    <h2 style="margin:0 0 24px">✏️ 自定义短语管理 <span class="badge">custom_phrase.txt</span></h2>
    <div class="section">
      <p class="muted" style="margin:0 0 16px">
        快速输入常用短语，提高输入效率。例如输入 <code>email</code> 显示您的邮箱地址，输入 <code>phone</code> 显示手机号。
      </p>

      <label style="flex-direction:column;align-items:flex-start;margin-bottom:12px">
        <span class="label-text" style="margin-bottom:8px;font-weight:600">自定义短语列表</span>
        <textarea id="customPhrases" placeholder="格式：编码&#9;短语文本&#10;&#10;示例：&#10;email&#9;your.email@example.com&#10;phone&#9;13800138000&#10;addr&#9;北京市朝阳区&#10;sign&#9;此致敬礼&#10;&#10;每行一个短语，用 Tab 键分隔编码和文本" style="width:100%;min-height:200px;font-family:'SF Mono',Monaco,Consolas,monospace;font-size:13px"></textarea>
      </label>

      <div class="hint" style="margin-top:12px">
        <strong>💡 使用说明：</strong>
        <ul style="margin:8px 0 0 20px;padding:0">
          <li>每行一个短语，格式：<code>编码[Tab键]文本内容</code></li>
          <li>编码可以是拼音、英文、数字等</li>
          <li>支持中文、英文、数字、符号等任意文本</li>
          <li>常用场景：邮箱、手机、地址、签名、常用语句等</li>
        </ul>
      </div>
    </div>
  </div>

  <div class="card">
    <h2 style="margin:0 0 24px">🎯 应用级控制 <span class="badge">app_options</span></h2>
    <div class="section">
      <p class="muted" style="margin:0 0 16px">
        为特定应用设置默认输入模式。例如在终端或代码编辑器中自动切换到英文模式。
      </p>

      <label style="flex-direction:column;align-items:flex-start;margin-bottom:12px">
        <span class="label-text" style="margin-bottom:8px;font-weight:600">应用 Bundle ID 列表</span>
        <textarea id="appOptions" placeholder="格式：Bundle ID（每行一个）&#10;&#10;常用示例：&#10;com.apple.Terminal&#10;com.microsoft.VSCode&#10;com.googlecode.iterm2&#10;com.jetbrains.intellij&#10;org.vim.MacVim&#10;&#10;这些应用将默认使用英文输入模式" style="width:100%;min-height:150px;font-family:'SF Mono',Monaco,Consolas,monospace;font-size:13px"></textarea>
      </label>

      <div class="hint" style="margin-top:12px">
        <strong>💡 如何获取 Bundle ID？</strong>
        <ul style="margin:8px 0 0 20px;padding:0">
          <li>打开"活动监视器"，找到应用，查看"Bundle ID"列</li>
          <li>或在终端运行：<code>osascript -e 'id of app "应用名称"'</code></li>
          <li>常用开发工具已为您预设在示例中</li>
        </ul>
      </div>
    </div>
  </div>

  <div class="card">
    <h2 style="margin:0 0 24px">🎨 鼠须管皮肤配置 <span class="badge">squirrel.custom.yaml</span></h2>
    <div class="grid">
      <div class="section">
        <h2>配色方案</h2>
        <label>
          <span class="label-text">浅色模式主题</span>
          <select id="colorScheme" style="flex:1;min-width:200px;max-width:400px;background:var(--input-bg);border:1px solid var(--border);border-radius:10px;padding:10px 14px;color:var(--text);font-size:14px;cursor:pointer">
            <option value="lost_temple" selected>孤寺 Lost Temple</option>
            <option value="google">Google</option>
            <option value="native">系统原生</option>
            <option value="aqua">碧水 Aqua</option>
            <option value="azure">青天 Azure</option>
            <option value="luna">明月 Luna</option>
            <option value="ink">墨池 Ink</option>
            <option value="dark_temple">暗堂 Dark Temple</option>
            <option value="starcraft">星际争霸 StarCraft</option>
            <option value="clean_white">纯白 Clean White</option>
            <option value="apathy">冷漠 Apathy</option>
            <option value="dust">微尘 Dust</option>
            <option value="solarized_rock">Solarized Rock</option>
            <option value="solarized_light">Solarized Light</option>
          </select>
        </label>
        <label>
          <span class="label-text">深色模式主题</span>
          <select id="colorSchemeDark" style="flex:1;min-width:200px;max-width:400px;background:var(--input-bg);border:1px solid var(--border);border-radius:10px;padding:10px 14px;color:var(--text);font-size:14px;cursor:pointer">
            <option value="dark_temple">暗堂 Dark Temple</option>
            <option value="mojave_dark">Mojave Dark</option>
            <option value="solarized_dark">Solarized Dark</option>
            <option value="ink">墨池 Ink</option>
            <option value="purity_of_form">Purity of Form</option>
            <option value="starcraft">星际争霸 StarCraft</option>
            <option value="google">Google</option>
            <option value="apathy">冷漠 Apathy</option>
          </select>
        </label>
        <div class="muted">系统外观切换时自动使用对应主题</div>
      </div>

      <div class="section">
        <h2>候选窗口布局</h2>
        <div class="radio-wrap">
          <label><input type="radio" name="candidateLayout" value="linear" checked /> 横向排列</label>
          <label><input type="radio" name="candidateLayout" value="stacked" /> 纵向排列</label>
        </div>
        <label style="margin-top:12px">
          <input class="switch" id="inlinePreedit" type="checkbox" checked />
          <span class="label-text">单行模式 (inline_preedit)</span>
        </label>
        <div class="muted">横向排列更紧凑，纵向排列更清晰</div>
      </div>
    </div>

    <div class="grid" style="margin-top:24px">
      <div class="section">
        <h2>字体设置</h2>
        <label>
          <span class="label-text">主字体</span>
          <input id="fontFace" type="text" value="PingFangSC" placeholder="PingFangSC, Hiragino Sans GB" />
        </label>
        <label>
          <span class="label-text">字体大小</span>
          <input id="fontSize" type="number" min="10" max="36" value="16" style="max-width:100px" />
        </label>
        <div class="muted">常用字体：PingFangSC, STHeiti, Hiragino Sans GB</div>
      </div>

      <div class="section">
        <h2>窗口外观</h2>
        <label>
          <span class="label-text">圆角半径</span>
          <input id="cornerRadius" type="number" min="0" max="20" value="5" style="max-width:100px" />
        </label>
        <label>
          <span class="label-text">行间距</span>
          <input id="lineSpacing" type="number" min="0" max="20" value="5" style="max-width:100px" />
        </label>
        <label>
          <span class="label-text">候选词间距</span>
          <input id="spacing" type="number" min="0" max="20" value="8" style="max-width:100px" />
        </label>
      </div>
    </div>
  </div>

  <div class="card">
    <h2>载入现有配置（可选）</h2>
    <div id="drop" class="drop">
      <div style="font-size:16px;margin-bottom:8px">📁 拖拽 <code>*.custom.yaml</code> 文件到此处</div>
      <div class="muted">自动解析并填充配置选项</div>
    </div>
  </div>

  <div class="card">
    <div class="row" style="justify-content:space-between;align-items:center;margin-bottom:16px">
      <h2 style="margin:0">配置预览与下载</h2>
      <div style="display:flex;gap:8px">
        <button id="btnDownloadZip">📦 下载压缩配置包</button>
        <button id="btnDownloadFiles">⬇ 下载完整配置</button>
      </div>
    </div>
    <div class="radio-wrap" style="margin-bottom:16px">
      <label><input type="radio" name="previewType" value="schema" checked /> 方案配置预览</label>
      <label><input type="radio" name="previewType" value="squirrel" /> 皮肤配置预览</label>
    </div>
    <textarea id="preview" readonly></textarea>
    <div class="hint">
      <strong>部署说明：</strong>
      <div style="margin-top:8px">
        <strong>方式 1：</strong>将下载的压缩包解压后，把所有文件放入 <code>~/Library/Rime/</code> 目录（Library 即"资源库"），然后在「鼠须管」菜单中点击「重新部署」。
      </div>
      <div style="margin-top:8px">
        <strong>方式 2：</strong>命令行一键部署（动态配置命令）

        <!-- 配置选项区域 -->
        <div style="margin-top:12px;padding:12px;background:var(--input-bg);border-radius:8px;border:1px solid var(--border)">
          <div class="muted" style="margin-bottom:12px">配置以下选项，命令将自动更新：</div>

          <div style="display:grid;gap:12px">
            <!-- 方案选择 -->
            <div style="display:flex;align-items:center;gap:8px">
              <span style="min-width:80px;font-size:13px">方案标识</span>
              <input id="cmdSchemaId" type="text" value="luna_pinyin" placeholder="luna_pinyin"
                     style="flex:1;padding:6px 10px;font-size:13px;font-family:monospace" />
              <span class="muted" style="font-size:12px">明月拼音</span>
            </div>

            <!-- 快捷键风格 -->
            <div style="display:flex;align-items:center;gap:8px">
              <span style="min-width:80px;font-size:13px">快捷键风格</span>
              <select id="cmdHotkeyStyle" style="flex:1;padding:6px 10px;font-size:13px">
                <option value="windows">Windows - Windows 风格</option>
                <option value="macos">macOS - macOS 风格</option>
                <option value="custom">Custom - 自定义</option>
              </select>
            </div>

            <!-- 皮肤方案 -->
            <div style="display:flex;align-items:center;gap:8px">
              <span style="min-width:80px;font-size:13px">皮肤方案</span>
              <select id="cmdColorScheme" style="flex:1;padding:6px 10px;font-size:13px">
                <option value="lost_temple">孤寺 - Lost Temple</option>
                <option value="google">Google</option>
                <option value="native">系统原生 - Native</option>
                <option value="aqua">碧水 - Aqua</option>
                <option value="azure">青天 - Azure</option>
                <option value="luna">明月 - Luna</option>
                <option value="ink">墨池 - Ink</option>
                <option value="dark_temple">暗堂 - Dark Temple</option>
                <option value="clean_white">纯白 - Clean White</option>
              </select>
            </div>

            <!-- 功能开关 -->
            <div style="display:flex;align-items:center;gap:12px;flex-wrap:wrap">
              <span style="min-width:80px;font-size:13px">功能开关</span>
              <label style="display:flex;align-items:center;gap:4px;font-size:13px;margin:0">
                <input type="checkbox" id="cmdEmoji" checked /> Emoji
              </label>
              <label style="display:flex;align-items:center;gap:4px;font-size:13px;margin:0">
                <input type="checkbox" id="cmdLunar" checked /> 农历
              </label>
              <label style="display:flex;align-items:center;gap:4px;font-size:13px;margin:0">
                <input type="checkbox" id="cmdSymbols" checked /> 符号
              </label>
            </div>
          </div>
        </div>

        <!-- 生成的命令 -->
        <div style="margin-top:12px">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
            <span style="font-size:13px;font-weight:600">生成的部署命令：</span>
            <button id="copyCmd" style="padding:6px 12px;font-size:12px">📋 复制命令</button>
          </div>
          <code id="deployCmd" style="display:block;padding:12px;cursor:pointer;user-select:all;max-height:150px;overflow-y:auto;word-break:break-all;white-space:pre-wrap;font-size:11px;line-height:1.6">命令将在配置后自动生成...</code>
        </div>

        <div class="muted" style="margin-top:8px;font-size:12px">💡 修改上方选项，命令会自动更新。复制命令到终端运行即可完成部署。</div>
      </div>
    </div>
  </div>
</div>

</div>
<!-- 完全模块化的应用 (46 行，原 1100 行已拆分为 8 个模块) -->
<script type="module" src="app.js"></script>
</body>
</html>
